<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Gnome applets with Python</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="NEXT"
TITLE="Running the applet in its own window"
HREF="x106.html"></HEAD
><BODY
CLASS="article"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="title"
><A
NAME="AEN1"
>Gnome applets with Python</A
></H1
><DIV
CLASS="authorgroup"
><A
NAME="AEN10"
></A
><H3
CLASS="author"
><A
NAME="AEN11"
>Arturo González Ferrer</A
></H3
><DIV
CLASS="affiliation"
><DIV
CLASS="address"
><P
CLASS="address"
><CODE
CLASS="email"
>&#60;<A
HREF="mailto:arturogf@ugr.es"
>arturogf@ugr.es</A
>&#62;</CODE
></P
></DIV
></DIV
><H3
CLASS="author"
><A
NAME="AEN20"
>Lorenzo Gil Sánchez</A
></H3
><DIV
CLASS="affiliation"
><DIV
CLASS="address"
><P
CLASS="address"
><CODE
CLASS="email"
>&#60;<A
HREF="mailto:lgs@sicem.biz"
>lgs@sicem.biz</A
>&#62;</CODE
></P
></DIV
></DIV
></DIV
><P
CLASS="copyright"
>Copyright &copy; 2004 The GNOME Project</P
><DIV
CLASS="revhistory"
><TABLE
WIDTH="100%"
BORDER="0"
><TR
><TH
ALIGN="LEFT"
VALIGN="TOP"
COLSPAN="3"
><B
>Revision History</B
></TH
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.5</TD
><TD
ALIGN="LEFT"
>07 February 2004</TD
><TD
ALIGN="LEFT"
></TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
></TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.4</TD
><TD
ALIGN="LEFT"
>23 January 2004 (added "change-orient" event to callbacks section)</TD
><TD
ALIGN="LEFT"
>Revised by: arturogf</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
></TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.3</TD
><TD
ALIGN="LEFT"
>20 January 2004 (merge 0.2 with the new version. Some updates on bonobo and .server files. Autotools installation).</TD
><TD
ALIGN="LEFT"
>Revised by: arturogf</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
></TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.2</TD
><TD
ALIGN="LEFT"
>15 January 2004 (some grammar and structure corrections)</TD
><TD
ALIGN="LEFT"
>Revised by: lgs</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
></TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.1</TD
><TD
ALIGN="LEFT"
>07 January 2004 (first release)</TD
><TD
ALIGN="LEFT"
>Revised by: arturogf</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
></TD
></TR
></TABLE
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
>1. <A
HREF="index.html#AEN55"
>Introduction</A
></DT
><DD
><DL
><DT
>1.1. <A
HREF="index.html#AEN64"
>The applet code skeleton</A
></DT
><DT
>1.2. <A
HREF="index.html#AEN92"
>The bonobo .server file</A
></DT
></DL
></DD
><DT
>2. <A
HREF="x106.html"
>Running the applet in its own window</A
></DT
><DT
>3. <A
HREF="x114.html"
>Moving on: Object Oriented Applets</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="x114.html#AEN119"
>The class definition</A
></DT
></DL
></DD
><DT
>4. <A
HREF="x124.html"
>The import section</A
></DT
><DT
>5. <A
HREF="x134.html"
>The class constructor: __init__</A
></DT
><DD
><DL
><DT
>5.1. <A
HREF="x134.html#AEN138"
>Some instance variable definitions</A
></DT
><DT
>5.2. <A
HREF="x134.html#AEN143"
>The GTK widgets definition</A
></DT
><DT
>5.3. <A
HREF="x134.html#AEN152"
>Optional timeout callback method</A
></DT
><DT
>5.4. <A
HREF="x134.html#AEN158"
>Connecting the "destroy" signal and show the applet</A
></DT
><DT
>5.5. <A
HREF="x134.html#AEN162"
>Connecting signals and events to handlers</A
></DT
><DD
><DL
><DT
>5.5.1. <A
HREF="x134.html#AEN167"
>Loading the interface with <TT
CLASS="filename"
>glade.XML()</TT
></A
></DT
><DT
>5.5.2. <A
HREF="x134.html#AEN181"
>Using the <TT
CLASS="filename"
>gtkWidget.connect()</TT
> method</A
></DT
></DL
></DD
></DL
></DD
><DT
>6. <A
HREF="x186.html"
>The callback methods</A
></DT
><DD
><DL
><DT
>6.1. <A
HREF="x186.html#AEN191"
>The timeout callback</A
></DT
><DT
>6.2. <A
HREF="x186.html#AEN201"
>The panel applet "change-orient" signal</A
></DT
></DL
></DD
><DT
>7. <A
HREF="x207.html"
>Autotools : a brief introduction to the installation process</A
></DT
><DD
><DL
><DT
>7.1. <A
HREF="x207.html#AEN217"
>The project structure: directories and files needed</A
></DT
><DT
>7.2. <A
HREF="x207.html#AEN269"
>Creating these files</A
></DT
><DT
>7.3. <A
HREF="x207.html#AEN291"
>Editing the files Makefile.am and configure.in</A
></DT
></DL
></DD
><DT
>8. <A
HREF="x304.html"
>Example applet</A
></DT
><DT
><A
HREF="b308.html"
>Bibliography</A
></DT
></DL
></DIV
><BLOCKQUOTE
CLASS="ABSTRACT"
><DIV
CLASS="abstract"
><P
></P
><A
NAME="AEN52"
></A
><P
>This article will cover how to make an applet for the GNOME 2.x desktop with the Python programming language. Usually, GNOME applets are made in C, which has the big advantage of generating compiled executables (this means less memory footprint and faster programs) but in the other hand it's more difficult to do it and it takes more time to write the code. Python programs are developed faster, they have fewer lines of code, and it's an object oriented programming language.  But it's an interpreted language, so the execution speed can be worse. It's up to the reader to decide if it is worthy writing a GNOME applet in Python. One good aproach is to prototype the applet in Python and then write the final version in C. Here we'll explain the necessary steps to write and deploy a simple applet from scratch using Glade 2 and libglade for the dialogs. Look at the bibliography for an in-deep explanation. Another good source of information is the pyGTK mailing list archives.</P
><P
>However, with regard to the code shown at the tutorial, we advise you to better look at the example section, where you will find some releases that do like it has been explained here, so you can see it growing from a prototype to a really functional applet.</P
><P
></P
></DIV
></BLOCKQUOTE
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="AEN55"
>1. Introduction</A
></H1
><P
>GNOME 2.x applets need at least two files to get them working:<P
></P
><UL
><LI
><P
>The executable (in this case the applet code)</P
></LI
><LI
><P
>The bonobo server component, that must be placed at <TT
CLASS="filename"
>/usr/lib/bonobo/servers</TT
> by default. This file contains all the information about the resources the applet will use for its execution.</P
></LI
></UL
>
</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN64"
>1.1. The applet code skeleton</A
></H2
><P
>The simplest applet we can write can be found in the gnome-python package documentation (<TT
CLASS="filename"
>/usr/share/doc/python2.x-gnome2/examples/applet/applet.py</TT
> in DEBIAN-based distributions) or simply in the gnome-python tarball from the original GNOME ftp.</P
><P
>&#13;
        <DIV
CLASS="warning"
><P
></P
><TABLE
CLASS="warning"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="/usr/share/sgml/docbook/stylesheet/dsssl/modular/images/warning.gif"
HSPACE="5"
ALT="Warning"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><PRE
CLASS="programlisting"
>place this at /usr/bin/pysample.py</PRE
></TD
></TR
></TABLE
></DIV
>
      </P
><PRE
CLASS="programlisting"
>&#13;        
        #!/usr/bin/env python
        import pygtk
        pygtk.require('2.0')

        import gtk
        import gnome.applet

        def sample_factory(applet, iid):
            label = gtk.Label("Success!")
            applet.add(label)

            applet.show_all()
            return gtk.TRUE

        gnome.applet.bonobo_factory("OAFIID:GNOME_PysampleApplet_Factory", 
                                     gnome.applet.Applet.__gtype__, 
                                     "hello", "0", sample_factory)

</PRE
><P
>First, we need to import some Python modules that we will need. The <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>pyGTK</I
></SPAN
> module, needed to specify the GTK version used (we'll be using 2.x in this article), the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>gnome</I
></SPAN
> module, that contains all the useful classes and methods about the gnome desktop, i.e. the applet class, and the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>gtk</I
></SPAN
> module, Python bindings for the GTK toolkit.
 </P
><P
>Then, we define the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>sample factory</I
></SPAN
> function to generate applet objects, with a text label "Sucess!". This function receives the object to be initializated (the applet) and the bonobo activation ID that the new factory will implement. It's all that simple. It returns gtk.TRUE if no errors were reported (see the panelapplet reference manual for details). When we call to <TT
CLASS="filename"
>gnome.applet.bonobo_factory()</TT
>.</P
><P
>When we call the <TT
CLASS="filename"
>bonobo_factory</TT
> method, we need to pass it the following arguments:
<P
></P
><OL
TYPE="1"
><LI
><P
>iid: The bonobo-activation iid of the factory.</P
></LI
><LI
><P
>type : the type of the created object.</P
></LI
><LI
><P
>description.</P
></LI
><LI
><P
>version.</P
></LI
><LI
><P
>factory callback: the name of the factory method.</P
></LI
></OL
>
</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN92"
>1.2. The bonobo .server file</A
></H2
><P
>&#13;     The second thing we need to get the applet running is to construct the bonobo server file. <TT
CLASS="filename"
>bonobo-activation-server</TT
>, the GNOME application that tracks information about installed components and brokers components, reads and mantains the component descriptions from <TT
CLASS="filename"
>/usr/lib/bonobo/servers/*.server</TT
>. These files provide an XML description of a component's capabilities which can be queried and manipulated by clients using the activation client library. <TT
CLASS="filename"
>Bonobo-activation-server</TT
>, also ensures that the minimum neccessary number of servers for your display setup are running.
</P
><P
>Bonobo activation server is nothing but a daemon implementing a set of CORBA interfaces. These CORBA interfaces implement a name service for the set of CORBA servers installed on your system. GNOME Object Activation Framework daemon (OAFD) knows about all the CORBA servers in your system, running or not. The OAF daemon will activate those servers if you ask for them. Each server is described by its .server file which contains among other things the IDL interfaces it implements, some specific properties and an IID (Implementation ID). Each IID has to be globally unique, and its format is pretty simple:</P
><PRE
CLASS="programlisting"
>               OAFIID:program_name:UUID</PRE
><P
>The bonobo factories are CORBA objects that allow the creation of other new CORBA objects. This is a common practice in GNOME. The use of factories will allow us to use only an executable to get several instances of the component.</P
><P
>So we need to define the .server file and place it at the location mentioned before:</P
><PRE
CLASS="programlisting"
>&#13;        
        &#60;oaf_info&#62;
        &#60;oaf_server iid="OAFIID:GNOME_PysampleApplet_Factory"
                    type="exe" location="/usr/bin/pysample.py"&#62;

                &#60;oaf_attribute name="repo_ids" type="stringv"&#62;
                        &#60;item value="IDL:Bonobo/GenericFactory:1.0"/&#62;
                        &#60;item value="IDL:Bonobo/Unknown:1.0"/&#62;
                &#60;/oaf_attribute&#62;
                &#60;oaf_attribute name="name" type="string" value="Python applet example"/&#62;
                &#60;oaf_attribute name="description" type="string" value="Python applet example"/&#62;
        &#60;/oaf_server&#62;

        &#60;oaf_server iid="OAFIID:GNOME_PysampleApplet"
                    type="factory" location="OAFIID:GNOME_PysampleApplet_Factory"&#62;

                &#60;oaf_attribute name="repo_ids" type="stringv"&#62;
                        &#60;item value="IDL:GNOME/Vertigo/PanelAppletShell:1.0"/&#62;
                        &#60;item value="IDL:Bonobo/Control:1.0"/&#62;
                        &#60;item value="IDL:Bonobo/Unknown:1.0"/&#62;
                &#60;/oaf_attribute&#62;
                &#60;oaf_attribute name="name" type="string" value="Python applet example"/&#62;
                &#60;oaf_attribute name="description" type="string" value="Python applet example"/&#62;
                &#60;oaf_attribute name="panel:category" type="string" value="Utility"/&#62;
                &#60;oaf_attribute name="panel:icon" type="string" value="bug-buddy.png"/&#62;
        &#60;/oaf_server&#62;
        &#60;/oaf_info&#62;
        
</PRE
><P
>The .server file registers two unique OAF identifiers, and give the activation-server the description of how the objects must be created. The first one is the Factory, that is created when the .py script is executed. The second is the applet itself, and is created asking the Factory how to do it. When we do the "add to panel" action in GNOME, it takes the OAF identifiers that are supposed to implement the "IDL:GNOME/Vertigo/PanelAppletShell:1.0" in its "repo_ids" attribute. The submenu is determined by the "panel:category" attribute, the icon from "panel:icon", the text displayed at the menu comes from "name" and the tooltip text from "description".</P
><P
>The <TT
CLASS="filename"
>sample_factory()</TT
> function is called when a new applet is created. It receives a container that should be populated with the applet contents.</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x106.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Running the applet in its own window</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>